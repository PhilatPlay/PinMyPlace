<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PinMyPlace - GPS Location Sharing for Deliveries</title>

    <!-- External CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <link rel="stylesheet" href="/css/styles.css" />

    <!-- External JavaScript Libraries -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <h1>üìç PinMyPlace</h1>
        <p>Share Your Exact Location for Easy Deliveries</p>
      </div>

      <!-- Authentication Section -->
      <div class="card" id="authCard">
        <!-- Login Form -->
        <div id="loginForm">
          <h3>üîê Welcome Back</h3>
          <p>Login to access your locations:</p>

          <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" placeholder="Enter your email" />
          </div>

          <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" id="password" placeholder="Enter password" />
          </div>

          <button onclick="login()">Login</button>
          <div id="authStatus"></div>

          <p style="margin-top: 15px; text-align: center">
            Don't have an account?
            <a
              href="#"
              onclick="showRegisterForm(); return false;"
              style="color: #667eea"
              >Sign up</a
            >
          </p>

          <div
            style="
              margin-top: 15px;
              padding: 10px;
              background: #f0f8ff;
              border-radius: 5px;
            "
          >
            <h4>Demo Accounts:</h4>
            <p><strong>Admin:</strong> team@blocklogik.com (Admin123!@#)</p>
            <p><strong>Test User:</strong> user@droplogik.com (User123!@#)</p>
            <p>
              <strong>Your Account:</strong> philip.polo@yahoo.com
              (Philip123!@#)
            </p>
          </div>
        </div>

        <!-- Register Form -->
        <div id="registerForm" style="display: none">
          <h3>üéâ Create Account</h3>
          <p>Start pinning your locations for free!</p>

          <div class="form-group">
            <label for="regName">Name:</label>
            <input type="text" id="regName" placeholder="Your name" />
          </div>

          <div class="form-group">
            <label for="regEmail">Email:</label>
            <input type="email" id="regEmail" placeholder="your@email.com" />
          </div>

          <div class="form-group">
            <label for="regPhone">Phone (optional):</label>
            <input type="tel" id="regPhone" placeholder="09XX-XXX-XXXX" />
          </div>

          <div class="form-group">
            <label for="regPassword">Password:</label>
            <input
              type="password"
              id="regPassword"
              placeholder="Create a password"
            />
          </div>

          <button onclick="register()">Create Account</button>
          <div id="regStatus"></div>

          <p style="margin-top: 15px; text-align: center">
            Already have an account?
            <a
              href="#"
              onclick="showLoginForm(); return false;"
              style="color: #667eea"
              >Login</a
            >
          </p>
        </div>
      </div>

      <!-- Main App Section (hidden until logged in) -->
      <div id="gpsDemo" style="display: none">
        <!-- User Info Bar -->
        <div
          class="card"
          style="
            background: #f8f9fa;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
          "
        >
          <div>
            <strong id="userDisplayName">User</strong>
            <span
              id="premiumBadge"
              style="
                display: none;
                margin-left: 10px;
                background: gold;
                color: #000;
                padding: 2px 8px;
                border-radius: 3px;
                font-size: 12px;
              "
              >‚≠ê PREMIUM</span
            >
          </div>
          <button
            onclick="logout()"
            style="width: auto; padding: 5px 15px; margin: 0; font-size: 13px"
          >
            Logout
          </button>
        </div>

        <!-- Main GPS Map Interface -->
        <div class="card">
          <h3>üó∫Ô∏è Pin Your Location</h3>
          <div class="map-instructions">
            <strong>Simple 3-step process:</strong><br />
            1Ô∏è‚É£ Click "Show Map & Get My Location" below<br />
            2Ô∏è‚É£ Drag the green marker to your exact location<br />
            3Ô∏è‚É£ Add optional address details and register
          </div>

          <div class="form-group">
            <label>Location Name/ID:</label>
            <input
              type="text"
              id="mapUserId"
              placeholder="e.g., My Home, Office, etc."
            />
          </div>

          <button onclick="initializeMap()">
            üó∫Ô∏è Show Map & Get My Location
          </button>

          <!-- Address field (appears after map loads) -->
          <div id="addressSection" style="display: none">
            <div class="form-group">
              <label>Address/Description (optional):</label>
              <input
                type="text"
                id="mapAddress"
                placeholder="e.g., White gate, near Jollibee"
              />
              <small style="color: #666"
                >Help delivery riders find you easier</small
              >
            </div>
          </div>

          <div id="mapContainer">
            <div id="map"></div>

            <!-- Map Controls (appears after map loads) -->
            <div id="mapControls" style="display: none">
              <div class="coordinate-display">
                <div>
                  <strong>üìç GPS Location:</strong>
                  <span id="originalCoords">-</span>
                </div>
                <div>
                  <strong>‚úÖ Corrected Location:</strong>
                  <span id="correctedCoords">-</span>
                </div>
                <div>
                  <strong>üìè Correction Distance:</strong>
                  <span id="correctionDistance">0m</span>
                </div>
              </div>

              <button
                onclick="registerCorrectedLocation()"
                class="register-btn"
              >
                üìç Register This Location
              </button>

              <div id="mapResult"></div>
            </div>
          </div>
        </div>

        <!-- Pricing Section -->
        <div class="card" id="pricingSection">
          <h3>üíé Choose Your Plan</h3>
          <p style="text-align: center; margin-bottom: 20px">
            Get premium features for unlimited locations!
          </p>

          <div class="grid">
            <!-- Free Plan -->
            <div class="pricing-card">
              <h4>Free</h4>
              <div class="price"><span class="price-currency">‚Ç±</span>0</div>
              <p class="price-period">Forever Free</p>

              <ul class="features-list">
                <li>1 active location</li>
                <li>QR code generation</li>
                <li>30-day expiration</li>
                <li>Basic support</li>
              </ul>

              <button
                onclick="showStatus('You are on the free plan!', 'info')"
                style="background: #6c757d !important"
              >
                Current Plan
              </button>
            </div>

            <!-- Premium Monthly -->
            <div class="pricing-card recommended">
              <div
                style="
                  background: #28a745;
                  color: white;
                  padding: 5px;
                  border-radius: 5px;
                  margin-bottom: 10px;
                "
              >
                <strong>‚≠ê RECOMMENDED</strong>
              </div>
              <h4>Premium</h4>
              <div class="price"><span class="price-currency">‚Ç±</span>29</div>
              <p class="price-period">per month</p>

              <ul class="features-list">
                <li>Unlimited locations</li>
                <li>Custom QR designs</li>
                <li>Never expires</li>
                <li>Delivery notes</li>
                <li>Priority support</li>
                <li>Location analytics</li>
              </ul>

              <button onclick="initiatePayment('monthly')" class="upgrade-btn">
                Upgrade Now
              </button>
            </div>
          </div>

          <!-- Yearly Plan Option -->
          <div
            style="
              text-align: center;
              margin-top: 20px;
              padding: 15px;
              background: #fff3cd;
              border-radius: 8px;
            "
          >
            <strong>üí∞ Save 31% with Yearly Plan!</strong><br />
            <span style="font-size: 24px; color: #667eea">‚Ç±299/year</span>
            <span
              style="
                text-decoration: line-through;
                color: #999;
                margin-left: 10px;
              "
              >‚Ç±348</span
            ><br />
            <button
              onclick="initiatePayment('yearly')"
              class="upgrade-btn"
              style="width: auto; margin-top: 10px; padding: 10px 30px"
            >
              Get Yearly Plan
            </button>
          </div>
        </div>

        <!-- Admin-Only Section -->
        <div id="adminSection" style="display: none">
          <div class="card">
            <h3>üîß Admin Tools</h3>
            <div class="lookup-section">
              <!-- Location ID Lookup -->
              <div class="lookup-group">
                <div class="form-group">
                  <label>Location ID:</label>
                  <input
                    type="text"
                    id="locationId"
                    placeholder="Enter location ID"
                  />
                </div>
                <button onclick="getLocation()">üîç Look Up Location</button>
              </div>

              <!-- User Location History -->
              <div class="lookup-group">
                <div class="form-group">
                  <label>User ID for Location History:</label>
                  <input
                    type="text"
                    id="lookupUserId"
                    placeholder="Enter user ID"
                  />
                </div>
                <button onclick="getUserLocations()">
                  üìã Get User's Locations
                </button>
              </div>

              <!-- Results section spans full width -->
              <div class="lookup-result-full">
                <div id="lookupResult"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div
        style="
          text-align: center;
          color: white;
          margin-top: 30px;
          padding: 20px;
        "
      >
        <p>
          &copy; 2025 PinMyPlace - Making deliveries easier in the Philippines
          üáµüá≠
        </p>
      </div>
    </div>

    <!-- Application JavaScript -->
    <script src="/js/utils.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/map.js"></script>
    <script src="/js/location.js"></script>
    <script src="/js/payment.js"></script>

    <script>
      // Update user display when logged in
      if (currentUser) {
        const displayName = document.getElementById("userDisplayName");
        if (displayName) {
          displayName.textContent = currentUser.name || currentUser.email;
        }

        const premiumBadge = document.getElementById("premiumBadge");
        if (premiumBadge && currentUser.isPremium) {
          premiumBadge.style.display = "inline-block";
        }
      }
    </script>
  </body>
</html>
